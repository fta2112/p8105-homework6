---
title: "Homework 6"
author: "Josephine Alford, Feben Asefaha"
date: "11/13/2017"
output: html_document
---

```{r setup, include=FALSE}

##loaded data from website, csv is too large to commit rn

library(tidyverse)
library(httr)
library(jsonlite)
library(plotly)
library(lubridate)
library(forcats)
library(stringr)

get_all_inspections = function(url) {
  
  all_inspections = vector("list", length = 0)
  
  loop_index = 1
  chunk_size = 50000
  DO_NEXT = TRUE
  
  while (DO_NEXT) {
    message("Getting data, page ", loop_index)
    
    all_inspections[[loop_index]] = 
      GET(url,
          query = list(`$order` = "zipcode",
                       `$limit` = chunk_size,
                       `$offset` = as.integer((loop_index - 1) * chunk_size)
                       )
          ) %>%
      content("text") %>%
      fromJSON() %>%
      as_tibble()
    
    DO_NEXT = dim(all_inspections[[loop_index]])[1] == chunk_size
    loop_index = loop_index + 1
  }
  
  all_inspections
  
}

url = "https://data.cityofnewyork.us/resource/9w7m-hzhe.json"

nyc_inspections = get_all_inspections(url) %>%
  bind_rows() 


knitr::opts_chunk$set(echo = TRUE)
```

```{r FA's first plot_ly}

##organizing by most recent inspection per restaurant

nyc_grade_prop <- nyc_inspections %>% 
  separate(grade_date, into = c("grade_date", "takeaway"), sep = "T") %>%
  select(-takeaway) %>% 
  separate(grade_date, into = c("year", "month", "day"), sep = "-") %>% 
  rename(name = dba) %>% 
  na.omit(grade)


#street, year, month, day) %>% 
  


View(nyc_grade_prop)

#group_by(year, day, boro, building, street, dba) 

##stuck, will go to office hours today :/

```

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
